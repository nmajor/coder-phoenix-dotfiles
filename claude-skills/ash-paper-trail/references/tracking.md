# Ash-Paper-Trail - Tracking

**Pages:** 2

---

## Home

**URL:** https://hexdocs.pm/ash_paper_trail/readme.html

**Contents:**
- Home
- AshPaperTrail
- Tutorials
- Reference

Welcome! This is the extension for keeping an audit log of changes to your Ash resources.

Hex Package Hex Preview (current file) Search HexDocs Download ePub version

Built using ExDoc (v0.38.4) for the Elixir programming language

---

## Getting started with AshPaperTrail

**URL:** https://hexdocs.pm/ash_paper_trail/getting-started-with-ash-paper-trail.html

**Contents:**
- Getting started with AshPaperTrail
- Including version resources in your domain
  - Including all version resources:
  - Including specific version resources
- Destroy Actions
  - Don't version destroys
  - Soft Destroys
  - Disable Foreign Keys (not recommended)
- Attributes
- Change Tracking Modes

First, add the dependency to your mix.exs

Next add :ash_ paper_trail to your .formatter.exs under import_deps.

Then, add the AshPaperTrail.Resource extension to any resource you would like to version and configure the change tracking mode

This will generate the version resource automatically and add them to your domain. The autogenerated resource will be named Version under the namespace of the original resource and will belong to the original resource. For example, if your original resource is MyApp.Post the autogenerated resource will be MyApp.Post.Version. Post has_many paper_trail_versions and Version belong_to source_version

First, add the AshPaperTrail.Domain extension to your domain.

Set include_versions? true in the configuration, like so:

Alternatively, you can configure individual version resources, like so:

If you are using AshPostgres, and you want to support destroy actions, you will need to do one of the following:

First, create a paper trail mixin if you haven't already

Second, configure it in the resource

Manually implement soft deletion, or use something like AshArchival to ensure that destroy actions are soft? and do not actually result in row deletion

configure AshPaperTrail to ignore the reference, like so:

This will make it skip creating a foreign key for the version source attribute

By default, attribute values are stored in the changes attribute. This is to protect you over time as your resources change. However, if there are attributes that you are confident will not change, you can create attributes for them on the version resource, like so:

This will make your version resource have foo and bar attributes (they will still show up in changes), i.e

Valid options are :snapshot and :changes_only and :full_diff.

:snapshot will json dump the contents of every attribute whether they changed or not.

{ subject: "new subject", body: "unchanged body", author: { name: "bob"}}

:changes_only will json dump the contents of only the attributes that have changed. Note if any part of an embedded attribute and array of embedded attributes, changes then the entire top level attribute is dumped.

{ subject: "new subject" }

:full_diff will json dump the contents of each attribute.

{ subject: { from: "subject", to: "new subject" }, body: { unchanged: "unchanged_body" }}, author: { changes: { unchanged: "bob" }}

You can record the actor who made the change by declaring one or more resources that can be actors.

Each belongs_to_actor w

*[Content truncated]*

**Examples:**

Example 1 (unknown):
```unknown
{:ash_paper_trail, "~> 0.5.7"}
```

Example 2 (unknown):
```unknown
[
    import_deps: [
      :ash_paper_trail,
  ]
```

Example 3 (unknown):
```unknown
use Ash.Resource,
  domain: MyDomain,
  extensions: [
    AshPaperTrail.Resource
  ]

  paper_trail do
    primary_key_type :uuid_v7 # default is :uuid
    change_tracking_mode :changes_only # default is :snapshot
    store_action_name? true # default is false
    ignore_attributes [:inserted_at, :updated_at] # the primary keys are always ignored
    ignore_actions [:destroy] # default is []
  end
```

Example 4 (unknown):
```unknown
use Ash.Domain,
  extensions: [
    AshPaperTrail.Domain
  ]
```

---
