# Keep image defaults, then override/extend
source-file /etc/tmux.conf

# Default terminal for xterm.js compatibility in browser-based Coder web terminal
set -g default-terminal "xterm-256color"
set -g default-shell /usr/bin/zsh
set -g default-command "/usr/bin/zsh -l"

# Usability and persistence for multi-device (iPhone browser to MacBooks)
set -g mouse on  # Touch scrolling/selection in web term; toggle if browser gestures conflict
set -g history-limit 100000  # High scrollback for persistent sessions
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1
set -g focus-events on
set -g escape-time 0
setw -g aggressive-resize on  # Auto-fit panes to iPhone screen size
set -g remain-on-exit on     # Preserve dead windows for background processes (e.g., Claude Code)
set -g exit-empty off        # Keep server alive across disconnects/reconnects
set -g allow-passthrough on  # Pass web terminal features (OSC52 clipboard, hyperlinks) through to xterm.js

# Clipboard for web/iOS sync (OSC52 works in xterm.js; copies to browser/iOS clipboard)
set -g set-clipboard external  # Use external (web) clipboard

# Vi keys with touch-friendly copy (enter copy-mode on drag, copy on release)
setw -g mode-keys vi
set -g status-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection  # 'v' starts selection (or drag)
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel  # 'y' copies
bind-key -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel  # Enter copies
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection  # Touch drag/release copies to buffer/web clipboard

# Pane splitting (intuitive for small.touch screen)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind '%'

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Toggle mouse (prefix + M-m): Off for native Safari touch/scroll if tmux interferes
bind M set -g mouse \; display "Mouse: #{?mouse,ON (tmux touch scroll/select),OFF (browser native)}"

# Minimal status for iPhone (fits narrow browser view)
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=default fg=default'
set -g status-left '#[bold] #S '  # Session name, bold
set -g status-left-length 20
set -g status-right '%H:%M %d/%m'  # Time/date
set -g status-right-length 20
setw -g window-status-current-style 'bold'  # Subtle highlight
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format ' #I:#W '
set -g status-interval 60

# Truecolor for web terminal
set -ga terminal-overrides ',xterm-256color:Tc'